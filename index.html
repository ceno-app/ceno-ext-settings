<!DOCTYPE html>
<html>
<head>
</head>
<body>
	<form id="myForm">
		<div id="auto_refresh">
		<label>Auto refresh
			<span class="value"></span>
			<input type="button" value="Toggle" name="auto_refresh">
		</label>
		</div>
		<div id="origin_access">
		<label>Origin access
			<span class="value"></span>
			<input type="button" value="Toggle" name="origin_access">
		</label>
		</div>
		<div id="proxy_access">
		<label>Proxy access
			<span class="value"></span>
			<input type="button" value="Toggle" name="proxy_access">
		</label>
		</div>
		<div id="injector_proxy">
		<label>Injector proxy
			<span class="value"></span>
			<input type="button" value="Toggle" name="injector_proxy">
		</label>
		</div>
		<div id="ipfs_cache">
		<label>IPFS cache
			<span class="value"></span>
			<input type="button" value="Toggle" name="ipfs_cache">
		</label>
		</div>
	</form>
</body>
<script>
const updDOMVal = (name, newval) => document.getElementById(name).children[0].children[0].textContent = newval;

class State extends Map {
  set (k, v) {
    updDOMVal(k, v);
    return super.set(k, v);
  }
}

window.addEventListener("load", () => {
  const form = document.getElementById("myForm");

  let state = new State();

  fetch('http://localhost/api/status')
    .then(x => x.json())
	.then(Object.entries)
	.then(x => x.map(([k,v]) => {
      state.set(k, v);
    }));

  const btns = Array.from(document.getElementById('myForm').getElementsByTagName('input'));
  btns.map(x =>
    x.addEventListener('click', _ =>
      fetch(`http://localhost/?${x.name}=disable`)
    )
  );
});
</script>
</html>
